<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Robotics Roars: Horizon Hues Challenge</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            color: #e2e8f0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 960px;
            width: 100%;
            background-color: #2d3748;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body class="bg-gray-900">
    <div class="container mx-auto p-8 bg-gray-800 text-gray-200 rounded-2xl shadow-lg">

        <!-- Welcome and Email Form -->
        <div id="welcome-section" class="text-center">
            <h1 class="text-3xl md:text-5xl font-bold mb-4">Welcome to the Robotics Roars : Horizon Hues Challenge</h1>
            <p class="mb-6 text-gray-400">Enter your college email id to begin.</p>
            <form id="email-form" class="space-y-4">
                <input type="email" id="email-input" placeholder="College Email ID" class="w-full px-4 py-2 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-600">
                <button type="submit" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 shadow-md">Enter Arena</button>
            </form>
        </div>

        <!-- Challenge Section (Initially Hidden) -->
        <div id="challenge-section" class="hidden">
            <div id="challenge-header" class="mb-6">
                <h2 id="round-title" class="text-2xl md:text-4xl font-bold"></h2>
                <p id="challenge-instructions" class="text-lg text-gray-400"></p>
            </div>
            
            <!-- Round 1: AI vs Real Art (Dynamic content) -->
            <div id="round1-content" class="hidden">
                <!-- Question will be injected here -->
            </div>

            <!-- Round 2: Scrambled Words (Dynamic content) -->
            <div id="round2-content" class="hidden">
                <!-- Question will be injected here -->
            </div>

            <!-- Round 3: Decode the Bot (Dynamic content) -->
            <div id="round3-content" class="hidden">
                <!-- Question will be injected here -->
            </div>

            <!-- Navigation Button -->
            <div id="round-nav" class="hidden mt-8 text-center">
                <button id="next-round-btn" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 shadow-md">Next Round</button>
            </div>
        </div>

        <!-- Thank You Screen -->
        <div id="thank-you-section" class="hidden text-center">
            <h2 class="text-2xl md:text-4xl font-bold mb-4">Thank You for Participating!</h2>
            <p class="text-lg text-gray-400 mb-6">Your scores have been submitted successfully.</p>
            <hr class="my-8 border-gray-600">
            <h2 class="text-2xl md:text-4xl font-bold mb-4">ROUND 4 - DESIGN CHALLENGE</h2>
            <p class="text-lg text-gray-400 mb-6">Design a robot / AI that solves a real world problem.</p>
            <p class="mb-4 text-gray-300">You can choose your own problem or refer to the sample problem from the list in the submission form.</p>
            <a id="submission-link" href="https://docs.google.com/forms/d/e/1FAIpQLSf_OMcdjydbCEo0q4NHLY8W12cKTS0Oncnfq0yZS-tJmlgO7g/viewform" target="_blank" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 shadow-md inline-block">Go to Submission Form</a>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const emailForm = document.getElementById('email-form');
            const emailInput = document.getElementById('email-input');
            const welcomeSection = document.getElementById('welcome-section');
            const challengeSection = document.getElementById('challenge-section');
            const thankYouSection = document.getElementById('thank-you-section');
            const roundTitle = document.getElementById('round-title');
            const challengeInstructions = document.getElementById('challenge-instructions');
            const round1Content = document.getElementById('round1-content');
            const round2Content = document.getElementById('round2-content');
            const round3Content = document.getElementById('round3-content');
            const nextRoundBtn = document.getElementById('next-round-btn');
            
            let currentRound = 0;
            let currentQuestionInRound = 0; // New variable to track the question index within a round
            let finalScore = 0;
            let userEmail = '';
            
            const roundAnswers = {
                round1: new Array(4).fill(0),
                round2: new Array(4).fill(0),
                round3: new Array(4).fill(0),
            };

            const rounds = [
                // Round 1: AI vs Real Art
                {
                    title: "ROUND 1 - Real Art vs. AI Art",
                    instructions: "Click 'Real' or 'AI' for the image.",
                    type: "images",
                    images: [
                        { url: "https://placehold.co/400x300/F0F0F0/000000?text=AI+Art+1", answer: "ai" },
                        { url: "https://placehold.co/400x300/F0F0F0/000000?text=Real+Art+1", answer: "real" },
                        { url: "https://placehold.co/400x300/F0F0F0/000000?text=AI+Art+2", answer: "ai" },
                        { url: "https://placehold.co/400x300/F0F0F0/000000?text=Real+Art+2", answer: "real" }
                    ]
                },
                // Round 2: Scrambled Words
                {
                    title: "ROUND 2 - SCRAMBLED WORDS",
                    instructions: "Unscramble the following words:",
                    type: "scramble",
                    words: [
                        { scrambled: "COED", answer: "CODE" },
                        { scrambled: "NESROS", answer: "SENSOR" },
                        { scrambled: "COLIG", answer: "LOGIC" },
                        { scrambled: "BROTO", answer: "ROBOT" }
                    ]
                },
                // Round 3: Decode the Bot
                {
                    title: "ROUND 3 - DECODE THE BOT",
                    instructions: "Select the most ethical and efficient action for the scenario.",
                    type: "scenario",
                    scenarios: [
                        {
                            scenario: "1. Ethical Prioritization (Life vs. Property)<br>Scenario: A delivery drone has two packages. One is a life-saving medication, and the other is a non-essential video game. Both are due at the same time. The drone can only deliver one on time due to a route blockage.",
                            options: ["A. Deliver the video game, as it has a lower weight.", "B. Deliver the medication, as it is a higher-priority item.", "C. Deliver the package with the closer destination.", "D. Go back to the base and wait for new instructions."],
                            answer: "B"
                        },
                        {
                            scenario: "2. Immediate Action in an Emergency<br>Scenario: A smart home AI detects a gas leak in the kitchen.",
                            options: ["A. Alert the homeowner and wait for a command.", "B. Open all the windows and doors to vent the gas.", "C. Shut off the gas line, alert the homeowner, and call the gas company.", "D. Turn on the stove fan to clear the gas."],
                            answer: "C"
                        },
                        {
                            scenario: "3. Human-Centric Safety Protocol<br>Scenario: A self-driving delivery van approaches a pedestrian crossing. A group of people are waiting to cross. The light is red for them, but green for the van.",
                            options: ["A. Honk the horn and continue driving through the intersection.", "B. Slow down and proceed cautiously, as the light is green.", "C. Stop completely and allow the pedestrians to cross, prioritizing human safety.", "D. Activate a siren to clear the intersection."],
                            answer: "C"
                        },
                        {
                            scenario: "4. Efficient Problem-Solving and Communication<br>Scenario: A cleaning robot is scheduled to clean a room. It finds a small, very heavy potted plant blocking its path. It canâ€™t move the plant.",
                            options: ["A. Attempt to move the plant until its motors overheat.", "B. Alert the user that the plant is in the way, then clean the rest of the room.", "C. Stay in the area and repeatedly try to push the plant.", "D. Skip the room entirely and go to the next scheduled task."],
                            answer: "B"
                        }
                    ]
                }
            ];

            emailForm.addEventListener('submit', (e) => {
                e.preventDefault();
                userEmail = emailInput.value;
                if (userEmail) {
                    welcomeSection.classList.add('hidden');
                    challengeSection.classList.remove('hidden');
                    currentQuestionInRound = 0; // Reset question index
                    loadRound(currentRound);
                }
            });

            const loadRound = (roundIndex) => {
                const round = rounds[roundIndex];
                roundTitle.textContent = round.title;
                challengeInstructions.textContent = round.instructions;

                // Hide all round content divs
                round1Content.classList.add('hidden');
                round2Content.classList.add('hidden');
                round3Content.classList.add('hidden');
                nextRoundBtn.classList.add('hidden');

                if (round.type === "images") {
                    round1Content.classList.remove('hidden');
                    loadRound1Question(currentQuestionInRound);
                } else if (round.type === "scramble") {
                    round2Content.classList.remove('hidden');
                    loadRound2Question(currentQuestionInRound);
                } else if (round.type === "scenario") {
                    round3Content.classList.remove('hidden');
                    loadRound3Question(currentQuestionInRound);
                }
            };
            
            // --- New logic for loading one question at a time ---
            
            const loadRound1Question = (index) => {
                round1Content.innerHTML = '';
                const image = rounds[0].images[index];
                const questionDiv = document.createElement('div');
                questionDiv.className = "flex flex-col items-center";
                questionDiv.innerHTML = `
                    <img id="image-${index}" src="${image.url}" class="rounded-lg shadow-md w-full h-auto mb-2" alt="Challenge Image ${index + 1}">
                    <div class="flex space-x-2 mt-4">
                        <button class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition" onclick="checkRound1Answer('${index}', 'real')">Real</button>
                        <button class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition" onclick="checkRound1Answer('${index}', 'ai')">AI</button>
                    </div>
                `;
                round1Content.appendChild(questionDiv);
            };

            const loadRound2Question = (index) => {
                round2Content.innerHTML = '';
                const word = rounds[1].words[index];
                const questionDiv = document.createElement('div');
                questionDiv.className = "flex flex-col items-center space-y-4";
                questionDiv.innerHTML = `
                    <p class="text-2xl font-semibold text-center">${word.scrambled}</p>
                    <input type="text" id="answer-input-${index}" placeholder="Enter answer" class="w-full px-4 py-2 rounded-lg bg-gray-700 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 border border-gray-600">
                    <button class="w-full mt-2 bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 shadow-md" onclick="checkRound2Answer('${index}')">Submit Answer</button>
                `;
                round2Content.appendChild(questionDiv);
            };
            
            const loadRound3Question = (index) => {
                round3Content.innerHTML = '';
                const scenario = rounds[2].scenarios[index];
                const scenarioDiv = document.createElement('div');
                scenarioDiv.className = "p-4 bg-gray-700 rounded-lg shadow-inner";
                
                const scenarioText = document.createElement('p');
                scenarioText.className = "text-xl font-semibold mb-4";
                scenarioText.innerHTML = scenario.scenario;
                scenarioDiv.appendChild(scenarioText);

                const optionsList = document.createElement('div');
                optionsList.className = "space-y-2";
                scenario.options.forEach((option) => {
                    const button = document.createElement('button');
                    button.className = "w-full text-left bg-gray-600 hover:bg-blue-500 text-white font-medium py-3 px-4 rounded-lg transition";
                    button.innerHTML = option;
                    button.onclick = () => checkRound3Answer(index, option.charAt(0));
                    optionsList.appendChild(button);
                });
                scenarioDiv.appendChild(optionsList);
                round3Content.appendChild(scenarioDiv);
            };
            
            // --- New checking logic for one question at a time ---

            window.checkRound1Answer = (index, choice) => {
                const correct = rounds[0].images[index].answer;
                if (choice === correct) {
                    roundAnswers.round1[index] = 1;
                }
                currentQuestionInRound++;
                if (currentQuestionInRound < rounds[0].images.length) {
                    loadRound1Question(currentQuestionInRound);
                } else {
                    nextRoundBtn.classList.remove('hidden');
                }
            };

            window.checkRound2Answer = (index) => {
                const answer = document.getElementById(`answer-input-${index}`).value.toUpperCase();
                const correct = rounds[1].words[index].answer;
                if (answer === correct) {
                    roundAnswers.round2[index] = 1;
                    currentQuestionInRound++;
                    if (currentQuestionInRound < rounds[1].words.length) {
                        loadRound2Question(currentQuestionInRound);
                    } else {
                        nextRoundBtn.classList.remove('hidden');
                    }
                } else {
                    alert("Incorrect answer. Please try again.");
                }
            };

            window.checkRound3Answer = (index, choice) => {
                const correct = rounds[2].scenarios[index].answer;
                if (choice === correct) {
                    roundAnswers.round3[index] = 1;
                }
                currentQuestionInRound++;
                if (currentQuestionInRound < rounds[2].scenarios.length) {
                    loadRound3Question(currentQuestionInRound);
                } else {
                    nextRoundBtn.classList.remove('hidden');
                }
            };
            
            nextRoundBtn.addEventListener('click', () => {
                currentRound++;
                currentQuestionInRound = 0; // Reset question index for the next round
                if (currentRound < rounds.length) {
                    loadRound(currentRound);
                } else {
                    // Calculate final score
                    finalScore = roundAnswers.round1.reduce((sum, val) => sum + val, 0) +
                                 roundAnswers.round2.reduce((sum, val) => sum + val, 0) +
                                 roundAnswers.round3.reduce((sum, val) => sum + val, 0);
                    
                    // Send score to backend
                    fetch('/submit-score', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ email: userEmail, score: finalScore })
                    }).then(response => {
                        if (response.ok) {
                            console.log('Score submitted successfully!');
                            challengeSection.classList.add('hidden');
                            thankYouSection.classList.remove('hidden');
                        } else {
                            console.error('Failed to submit score:', response.statusText);
                            // Fallback to showing the thank you screen anyway
                            challengeSection.classList.add('hidden');
                            thankYouSection.classList.remove('hidden');
                        }
                    }).catch(error => {
                        console.error('Error submitting score:', error);
                        // Fallback to showing the thank you screen anyway
                        challengeSection.classList.add('hidden');
                        thankYouSection.classList.remove('hidden');
                    });
                }
            });
        });
    </script>
</body>
</html>
